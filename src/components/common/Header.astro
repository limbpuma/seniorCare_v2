---
import Button from "../common/Button.astro";
import Icon from "../common/Icon.astro";
import Logo from "./Logo.astro";
import Nav from "./Nav.astro";
import DynamicText from "./DynamicText.astro";
import texts from "@/utils/texts.json";
import { api } from "@/utils/api";

interface NavAnchor {
  id: string;
  label: string;
}

const headerTexts = texts.header;
const { navAnchors, useDynamicContent = false } = Astro.props;

// Cargar datos din치micos del backend si est치 habilitado
let dynamicTexts = null;
if (useDynamicContent) {
  try {
    dynamicTexts = await api.getTexts();
  } catch (error) {
    console.error('Error loading dynamic header texts:', error);
  }
}

// Usar textos din치micos o fallback a est치ticos
const phone = dynamicTexts?.header?.phone || headerTexts.phone;
// const email = dynamicTexts?.header?.email || headerTexts.email;
const ctaButton = dynamicTexts?.header?.cta_button || headerTexts.cta;

const NAVIGATION = navAnchors 
  ? navAnchors.map((anchor: NavAnchor) => ({ name: anchor.label, href: `#${anchor.id}`, isAnchor: true }))
  : [
    { name: headerTexts.nav.home, href: "/" },
    { name: headerTexts.nav.about, href: "/#about" },
    { name: headerTexts.nav.services, href: "/#services" },
    { name: headerTexts.nav.contact, href: "/#contact" },
    { name: headerTexts.nav.faq, href: "/#faq" },
  ];
---

<!-- 
  OPTIMIZED HEADER HEIGHTS for 100vh Compliance:
  Contact Bar: py-2 (~2rem total with content)
  Main Nav: Mobile 3.5rem + Tablet 4rem + Desktop 4.5rem
  Total Header: ~5-6rem depending on screen size
  This ensures header + hero section fit within 100vh
-->
<header class="w-full backdrop-blur-sm bg-white/95 shadow-lg shadow-deep-blue/5 sticky top-0 z-50">  <!-- Top Navbar Contact Bar -->
  <div class="bg-gradient-to-r from-primary/5 via-soft-blue/5 to-primary/5 text-ag-body-text border-b border-primary/10">
    <div class="max-w-7xl mx-auto">      <div class="flex items-center justify-between py-2 px-3 md:px-2 lg:px-4">
        <!-- Left: Address & Phone -->
        <div class="flex items-center gap-2 md:gap-4">          <!-- Address - Desktop only (lg+) -->
          <a
            href="https://maps.app.goo.gl/UbA5eCbGWvF2pyPu9"
            target="_blank"
            rel="noopener noreferrer"
            class="hidden lg:flex items-center gap-2 text-sm hover:text-primary transition-all duration-300 group hover-lift"
            aria-label="Visit our location on Google Maps (opens in new tab)"
          >
            <Icon
              icons={[{ name: "mapMarker" }]}
              size="small"
              variant="default"
            />
            <span class="group-hover:underline group-hover:text-transparent group-hover:bg-gradient-to-r group-hover:from-primary group-hover:to-soft-blue group-hover:bg-clip-text transition-all duration-300">{headerTexts.address}</span>
          </a>          <!-- Phone - Always visible -->          <a
            href={`tel:${phone}`}
            class="flex items-center gap-2 text-xs md:text-sm font-medium hover:text-primary transition-all duration-300 group hover-lift"
            aria-label={`Call us at ${phone}`}
            role="link"
          >
            <Icon
              icons={[{ name: "phone" }]}
              size="small"
              variant="default"
            />
            <span class="group-hover:underline group-hover:text-transparent group-hover:bg-gradient-to-r group-hover:from-primary group-hover:to-soft-blue group-hover:bg-clip-text transition-all duration-300">{phone}</span>
          </a>
        </div>        <!-- Right: Schedule & Social -->
        <div class="flex items-center gap-2 md:gap-4">
          <!-- Schedule - Always visible -->
          <div class="flex items-center gap-2 text-xs md:text-sm group hover-lift transition-all duration-300">
            <Icon icons={[{ name: "clock" }]} size="small" variant="default" />
            <span class="group-hover:text-transparent group-hover:bg-gradient-to-r group-hover:from-primary group-hover:to-soft-blue group-hover:bg-clip-text transition-all duration-300">{headerTexts.schedule}</span>
          </div>
          
          <!-- Social Links - Medium+ screens -->
          <div class="hidden md:flex items-center gap-2">
            <Icon
              icons={[
                { name: "facebook", href: headerTexts.socialLinks.facebook },
                { name: "twitter", href: headerTexts.socialLinks.twitter },
                {
                  name: "instagram",
                  href: headerTexts.socialLinks.instagram,
                },
              ]}
              size="small"
              variant="default"
            />
          </div>
        </div>
      </div>
    </div>
  </div>  <!-- Main Navigation -->
  <nav class="bg-white/90 backdrop-blur-md border-b border-primary/10 shadow-sm">
    <div class="max-w-7xl mx-auto">
      <div class="flex items-center justify-between py-2 px-3 md:px-2 lg:px-4 min-h-[3rem] md:min-h-[4rem] lg:min-h-[4.5rem] xl:min-h-[4.5rem] 2xl:min-h-[5rem]">
        <!-- Logo section -->
        <div class="flex-shrink-0 flex items-center">
          <a 
            href="/" 
            class="block focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded-lg min-h-[44px] p-2 -m-2 hover-lift transition-all duration-300 group"
            aria-label="Go to homepage"
          >
            <Logo class="h-8 md:h-10 lg:h-12 xl:h-12 2xl:h-14 w-auto group-hover:scale-105 transition-transform duration-300" color="dark" />
          </a>
        </div>

        <!-- Navigation Links - Desktop -->
        <div class="desktop-nav hidden md:flex items-center justify-center">
          <Nav links={NAVIGATION} />
        </div>

        <!-- Button and Mobile menu -->
        <div class="flex items-center gap-2 md:gap-4 shrink-0">          <Button 
            class="hidden md:inline-flex items-center text-sm lg:text-base py-2 px-3 lg:px-4 min-w-[120px] lg:min-w-[140px]" 
            variant="primary" 
            size="medium"
            href={`tel:${phone}`}
          >
            {ctaButton}
          </Button>          <!-- Mobile menu button -->
          <button
            data-collapse-toggle="navbar-cta"
            type="button"
            class="inline-flex items-center justify-center p-3 text-deep-blue rounded-xl md:hidden lg:hidden xl:hidden 2xl:hidden hover:bg-gradient-to-r hover:from-primary/10 hover:to-soft-blue/10 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-300 min-h-[44px] min-w-[44px] modern-card hover-lift"
            aria-controls="navbar-cta"
            aria-expanded="false"
            aria-label="Open navigation menu"
          >
            <span class="sr-only">Open main menu</span>
            <svg
              class="w-6 h-6 hamburger-icon"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                class="hamburger-line hamburger-line-1"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16"
              />
              <path
                class="hamburger-line hamburger-line-2"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 12h16"
              />
              <path
                class="hamburger-line hamburger-line-3"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 18h16"
              />
            </svg>
          </button>
        </div>
      </div>      <!-- Mobile menu -->
      <div class="md:hidden hidden transition-all duration-300 ease-in-out glass-morphism" id="navbar-cta">
        <div class="px-2 pt-2 pb-3 space-y-1 bg-white/95 backdrop-blur-md border-t border-primary/20">
          <Nav links={NAVIGATION} />
          <div class="mt-4">            <Button 
              class="w-full text-center justify-center py-2"
              variant="primary" 
              size="medium"
              href={`tel:${phone}`}
            >
              {ctaButton}
            </Button>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>

<style>
  /* Mobile menu animations */
  #navbar-cta {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    transition: all 0.3s ease-in-out;
  }
  
  #navbar-cta.mobile-menu-open {
    max-height: 500px;
    opacity: 1;
  }
    /* Ensure proper hiding on medium+ screens */
  @media (min-width: 768px) {
    #navbar-cta {
      display: none !important;
    }
    
    /* Force hide hamburger button on tablets and larger screens */
    button[data-collapse-toggle="navbar-cta"] {
      display: none !important;
    }
  }
  
  /* Additional safety for large screens */
  @media (min-width: 1024px) {
    button[data-collapse-toggle="navbar-cta"] {
      display: none !important;
    }
  }
    /* Additional safety for extra large screens */
  @media (min-width: 1280px) {
    button[data-collapse-toggle="navbar-cta"] {
      display: none !important;
    }
  }
  
  /* Ensure desktop navigation is always visible on larger screens */
  @media (min-width: 768px) {
    .desktop-nav {
      display: flex !important;
    }
  }
  
  /* Smooth hamburger button animation */
  button[data-collapse-toggle] {
    transition: all 0.2s ease-in-out;
  }
  
  button[data-collapse-toggle]:hover {
    background-color: rgba(0, 0, 0, 0.05);
  }
  
  /* Hamburger icon animation */
  .hamburger-line {
    transition: all 0.3s ease-in-out;
    transform-origin: center;
  }
  
  /* When menu is open, transform hamburger to X */
  button[aria-expanded="true"] .hamburger-line-1 {
    transform: rotate(45deg) translate(5px, 5px);
  }
  
  button[aria-expanded="true"] .hamburger-line-2 {
    opacity: 0;
  }
  
  button[aria-expanded="true"] .hamburger-line-3 {
    transform: rotate(-45deg) translate(7px, -6px);
  }
</style>

<script>
  import '@/utils/landing-page-navigator.js';
</script>
